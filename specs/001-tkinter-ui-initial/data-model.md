# Data Model: Tkinter UI Initial Implementation

**Date**: 2025-11-12
**Feature**: Tkinter UI Initial Implementation

## Overview

The UI feature introduces three main data entities that support configuration management, UI state tracking, and status communication. All entities are designed for simplicity and minimal storage requirements.

## Entities

### Configuration Settings

**Purpose**: Stores user-configurable parameters for download operations
**Storage**: JSON file (`~/.coupadownloads/ui_config.json`)
**Lifecycle**: Created on first use, updated on save, loaded on startup

**Fields**:
- `workers` (integer): Number of parallel download workers (1-10, default: 4)
- `download_dir` (string): Absolute path to download directory (default: "./downloads")
- `input_csv` (string): Absolute path to input CSV file (optional)
- `max_retries` (integer): Maximum retry attempts per download (0-10, default: 3)
- `last_updated` (datetime): ISO format timestamp of last configuration change

**Validation Rules**:
- `workers`: Must be integer between 1-10
- `download_dir`: Must be writable directory path
- `input_csv`: If provided, must be readable file with .csv extension
- `max_retries`: Must be integer between 0-10

**Relationships**: None (standalone configuration)

### UI State

**Purpose**: Tracks current state of UI components and operations
**Storage**: In-memory only (not persisted)
**Lifecycle**: Created with UI, updated during operation, destroyed on exit

**Fields**:
- `operation_status` (enum): Current operation state
  - Values: "ready", "running", "stopping", "error"
- `start_button_enabled` (boolean): Whether start button is clickable
- `stop_button_enabled` (boolean): Whether stop button is clickable
- `current_config` (Configuration Settings): Currently loaded configuration
- `active_tab` (string): Currently selected notebook tab ("Configuration", "Monitor")

**Validation Rules**:
- `operation_status`: Must be one of defined enum values
- Boolean fields: Must be true/false
- `active_tab`: Must be valid tab name

**Relationships**:
- References Configuration Settings for current values
- Used by UI components to determine display state

### Status Messages

**Purpose**: Real-time communication of operation status to UI
**Storage**: Queue-based (temporary, in-memory)
**Lifecycle**: Created during operations, consumed by UI, discarded after display

**Fields**:
- `timestamp` (datetime): When message was generated (ISO format)
- `level` (enum): Message severity level
  - Values: "info", "warning", "error", "success"
- `message` (string): Human-readable status text (max 200 chars)
- `operation_id` (string): Optional identifier for tracking related messages

**Validation Rules**:
- `timestamp`: Must be valid ISO datetime string
- `level`: Must be one of defined enum values
- `message`: Must not be empty, max 200 characters
- `operation_id`: Optional UUID format if provided

**Relationships**:
- Generated by core download processes
- Consumed by UI status display components

## Data Flow

```
User Input → Configuration Settings → UI State → Status Messages → UI Display
    ↑              ↓                        ↓
    └── Save ── Load ── Validate ── Update ── Render
```

## Schema Definitions

### JSON Schema for Configuration Settings

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "workers": {
      "type": "integer",
      "minimum": 1,
      "maximum": 10,
      "default": 4
    },
    "download_dir": {
      "type": "string",
      "format": "uri-reference",
      "default": "./downloads"
    },
    "input_csv": {
      "type": "string",
      "format": "uri-reference",
      "pattern": "\\.csv$"
    },
    "max_retries": {
      "type": "integer",
      "minimum": 0,
      "maximum": 10,
      "default": 3
    },
    "last_updated": {
      "type": "string",
      "format": "date-time"
    }
  },
  "required": ["workers", "download_dir", "max_retries", "last_updated"]
}
```

### TypeScript-style Interface Definitions

```typescript
interface ConfigurationSettings {
  workers: number;        // 1-10
  download_dir: string;   // Absolute path
  input_csv?: string;     // Absolute path, optional
  max_retries: number;    // 0-10
  last_updated: string;   // ISO datetime
}

interface UiState {
  operation_status: 'ready' | 'running' | 'stopping' | 'error';
  start_button_enabled: boolean;
  stop_button_enabled: boolean;
  current_config: ConfigurationSettings;
  active_tab: string;
}

interface StatusMessage {
  timestamp: string;      // ISO datetime
  level: 'info' | 'warning' | 'error' | 'success';
  message: string;        // Max 200 chars
  operation_id?: string;  // UUID format, optional
}
```

## Migration Strategy

**No migration needed** - This is a new feature with no existing data to migrate. Configuration files will be created on first use with default values.

## Testing Considerations

- **Configuration Settings**: Test validation rules, file I/O, default values
- **UI State**: Test state transitions, button enable/disable logic
- **Status Messages**: Test queue operations, message formatting, level handling

## Security Considerations

- Configuration files may contain file paths - validate paths are safe
- Status messages should not contain sensitive information
- UI state is in-memory only - no persistence security concerns