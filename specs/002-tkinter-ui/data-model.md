# Data Model: Tkinter UI Implementation

**Feature**: 002-tkinter-ui
**Date**: 2025-11-12

## Entities

### Configuration Settings

**Purpose**: User preferences for download operations, persisted across sessions

**Fields**:
- `worker_count`: int (range: 1-10, default: 3) - Number of parallel download workers
- `download_directory`: Path (required, must be writable) - Directory for downloaded files
- `csv_file_path`: Path (required, must exist and be readable) - Input CSV file with download targets
- `max_retries`: int (range: 0-5, default: 2) - Maximum retry attempts per download
- `last_modified`: datetime (auto-updated) - Timestamp of last configuration change

**Validation Rules**:
- `worker_count`: Must be integer 1-10
- `download_directory`: Must exist, be directory, be writable
- `csv_file_path`: Must exist, be file, be readable, have .csv extension
- `max_retries`: Must be integer 0-5

**Relationships**:
- Loaded by UI on startup
- Saved by UI on configuration changes
- Read by worker processes for operation parameters

### UI State

**Purpose**: Current state of GUI components and active operations

**Fields**:
- `config_loaded`: bool (default: false) - Whether valid configuration is loaded
- `operation_running`: bool (default: false) - Whether download operation is active
- `start_button_enabled`: bool (computed) - Start button availability
- `stop_button_enabled`: bool (computed) - Stop button availability
- `status_text`: str (default: "Ready") - Current status message
- `progress_percentage`: int (range: 0-100, default: 0) - Operation progress

**Validation Rules**:
- `status_text`: Max length 200 characters
- `progress_percentage`: Must be 0-100

**State Transitions**:
- `Ready` → `Running` (on start)
- `Running` → `Ready` (on completion/stop)
- `Ready` → `Error` (on configuration validation failure)

**Relationships**:
- Updated by GUI event handlers
- Read by UI components for display state
- Communicated to worker processes for coordination

### Status Messages

**Purpose**: Real-time updates about download progress and system state

**Fields**:
- `timestamp`: datetime (auto-generated) - When message was created
- `level`: enum (INFO, WARNING, ERROR, SUCCESS) - Message severity
- `message`: str (required, max 500 chars) - Human-readable status text
- `operation_id`: str (optional) - Identifier for related operation
- `progress`: int (optional, 0-100) - Associated progress percentage

**Validation Rules**:
- `message`: Non-empty, max 500 characters
- `level`: Must be valid enum value
- `progress`: If provided, must be 0-100

**Relationships**:
- Generated by worker processes
- Consumed by GUI for status display
- Queued for thread-safe GUI updates

## Data Flow

### Configuration Flow
1. UI loads configuration on startup from `~/.coupadownloads/config.ini`
2. User modifies settings through GUI controls
3. UI validates changes against business rules
4. Valid configuration saved to disk with secure permissions
5. Worker processes read configuration for operation parameters

### Status Flow
1. Worker processes generate status messages during operations
2. Messages queued in thread-safe Queue
3. GUI main thread processes queue periodically
4. UI state updated based on message content
5. Status display refreshed with new information

### State Synchronization
- UI state changes trigger visual updates immediately
- Configuration changes persist across application restarts
- Status messages provide real-time feedback without blocking UI

## Storage Strategy

### Configuration Storage
- **Format**: INI file using configparser
- **Location**: `~/.coupadownloads/config.ini`
- **Permissions**: 0o600 (user read/write only)
- **Backup**: Automatic backup on save

### Runtime State
- **Storage**: In-memory only (not persisted)
- **Synchronization**: Thread-safe updates via Queue
- **Recovery**: State reset on application restart

### Status Messages
- **Storage**: In-memory queue during operation
- **Retention**: Messages kept until operation completes
- **Logging**: Important messages logged to application log